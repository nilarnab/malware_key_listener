from datetime import datetime
import csv
import os
from pynput.keyboard import Key, Listener

limit = 50


def init_file():
    if (not os.path.exists("fishes")):
        os.mkdir("fishes")

    file = open('./fishes/' + str(datetime.now().strftime("%d-%m-%Y %H-%M-%S")) + '.csv', 'w')

    # file = open('./fishes/test.csv', 'w')

    fields = ['data', 'time', 'date']

    file_writer = csv.writer(file)

    file_writer.writerow(fields)

    return file_writer


def make_an_entry(val):
    global writer

    date = datetime.now().strftime("%d-%m-%Y")
    time = datetime.now().strftime("%H-%M-%S")

    data = [val, time, date]
    print("making an entry", )
    writer.writerow(data)


def alive(key):
    global limit
    global writer
    print("pressed", key)
    make_an_entry(key)
    limit -= 1

    if not limit:
        exit(0)


if __name__ == '__main__':
    global writer
    writer = init_file()

    print("started to listen")
    with Listener(on_press=alive) as listener:
        listener.join()